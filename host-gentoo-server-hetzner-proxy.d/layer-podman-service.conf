name="podman-compose service"
description="runs podman-compose on boot"

# Set the working directory where your compose.yaml is located
COMPOSE_DIR="/opt/myproject/app"
# Set the name of your Compose project (usually the directory name)
COMPOSE_PROJECT="myproject"
# Set the command. Ensure 'podman-compose' is in the system's PATH.
COMPOSE_CMD="/usr/bin/podman-compose"
# Set the user to run the commands as (important for rootless Podman)
command_user="myuser" 

depend() {
    need net
}

start() {
    cd "${COMPOSE_DIR}" || return 1
    /usr/bin/runuser -u "${command_user}" -- \
        "${COMPOSE_CMD}" up -d
    eend $?
}

stop() {
    cd "${COMPOSE_DIR}" || return 1
    /usr/bin/runuser -u "${command_user}" -- \
        "${COMPOSE_CMD}" down
    eend $?
}

status() {
    cd "${COMPOSE_DIR}" 2>/dev/null || return 1
    /usr/bin/runuser -u "${command_user}" -- \
        "${COMPOSE_CMD}" ps
    return 0
}
